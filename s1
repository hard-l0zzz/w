ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ² Ğ±Ğ´

CREATE TABLE departments(
DepartmentId INT PRIMARY KEY AUTO_INCREMENT,
Name VARCHAR(150) NOT NULL,
Description TEXT
);

CREATE TABLE positions(
PositionId INT PRIMARY KEY AUTO_INCREMENT,
Title VARCHAR(150) NOT NULL
);

CREATE TABLE employees(
EmployeeId INT PRIMARY KEY AUTO_INCREMENT,
FullName VARCHAR(100) NOT NULL,
DepartmentId INT,
PositionId INT,
FOREIGN KEY (DepartmentId) REFERENCES departments(DepartmentId) ON DELETE SET NULL,
FOREIGN KEY (PositionId) REFERENCES positions(PositionId) ON DELETE SET NULL
);

CREATE TABLE employees_contacts(
ContactId INT PRIMARY KEY AUTO_INCREMENT,
EmployeeId INT NOT NULL,
MobilePhone VARCHAR(20),
WorkPhone VARCHAR(20),
Email VARCHAR(50),
OfficeNUmber VARCHAR(10),
FOREIGN KEY (EmployeId) REFERENCES employees(EmployeeId) ON DELETE CASCADE
);

CREATE TABLE employees_personal_info(
PersonalInfoId INT PRIMARY KEY AUTO_INCREMENT,
EmployeeId INT NOT NULL,
BirthDate DATE,
AdditionalInfo TEXT,
FOREIGN KEY (EmployeId) REFERENCES employees(EmployeeId) ON DELETE CASCADE
);

CREATE TABLE events (
    EventId INT PRIMARY KEY AUTO_INCREMENT,
    EventType ENUM('Meeting', 'Conference', 'Training', 'Other') NOT NULL,
    Title VARCHAR(255) NOT NULL,
    Description TEXT,
    StartDate DATETIME NOT NULL,
    EndDate DATETIME NOT NULL
);

CREATE TABLE materials (
    MaterialId INT PRIMARY KEY AUTO_INCREMENT,
    MaterialName VARCHAR(255) NOT NULL,
    MaterialDescription TEXT,
    FilePath VARCHAR(255),
    EventId INT NOT NULL,
    FOREIGN KEY (EventId) REFERENCES events(EventId) ON DELETE CASCADE
);

CREATE TABLE employees_events (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    EmployeeId INT NOT NULL,
    EventId INT NOT NULL,
    FOREIGN KEY (EmployeeId) REFERENCES employees(EmployeeId) ON DELETE CASCADE,
    FOREIGN KEY (EventId) REFERENCES events(EventId) ON DELETE CASCADE
);
Ğ½Ğµ Ğ·Ğ°Ğ±Ñ‹Ñ‚ÑŒ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ working calendar


Ğ”Ğ›Ğ¯ Ğ¡ĞĞ Ğ¢Ğ˜Ğ ĞĞ’ĞšĞ˜ Ğ­ĞšĞ¡Ğ•Ğ›Ğ¬ Ğ¤ĞĞ™Ğ›Ğ

import pandas as pd

import re

  

df = pd.read_excel("pandas_xlsx_to_mysql\dannie.xlsx",skiprows=7)

current_department = None

new_data = []

  

for index,row in df.iterrows():

Â  Â  if pd.notna(row[0]):

Â  Â  Â  Â  if '.' in str(row[0]):

Â  Â  Â  Â  Â  Â  current_department = row[0]

Â  Â  Â  Â  else:

Â  Â  Â  Â  Â  Â  if pd.notna(row[1]):

Â  Â  Â  Â  Â  Â  Â  Â  full_name = row[1]

Â  Â  Â  Â  Â  Â  else:

Â  Â  Â  Â  Â  Â  Â  Â  full_name = None

Â  Â  Â  Â  Â  Â  if full_name:

Â  Â  Â  Â  Â  Â  Â  Â  new_data.append([full_name,cleaned_department,row[0],row[2],row[3],row[4],row[5]])

new_df = pd.DataFrame(new_data, columns=["Ğ¤Ğ˜Ğ", "Ğ”ĞµĞ¿Ğ°Ñ€Ñ‚Ğ°Ğ¼ĞµĞ½Ñ‚", "Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ","Ğ”Ğ°Ñ‚Ğ° Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ","Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹","ĞšĞ°Ğ±Ğ¸Ğ½ĞµÑ‚","ĞšĞ¾Ñ€Ğ¿Ğ¾Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ email"])

with pd.ExcelWriter('output_file2.xlsx') as writer:

Â  Â  new_df.to_excel(writer,index=False)

Ğ”Ğ›Ğ¯ Ğ˜ĞœĞŸĞĞ Ğ¢Ğ Ğ­Ğ¢ĞĞ“Ğ Ğ­ĞšĞ¡Ğ•Ğ›Ğ¯ Ğ’ MYSQL

import pandas as pd

from sqlalchemy import create_engine

engine = create_engine('mysql+mysqlconnector://moodleuser:moodleuserpsw@localhost/wsr2025_db')

df = pd.read_excel('output_file.xlsx')

df.to_sql('employees_data', con=engine, if_exists='replace', index=False)

Ğ”Ğ›Ğ¯ Ğ’Ğ¡Ğ¢ĞĞ’ĞšĞ˜ Ğ˜Ğ— Ğ¢ĞĞ™ Ğ¢ĞĞ‘Ğ›Ğ˜Ğ¦Ğ« Ğ’ Ğ”Ğ Ğ£Ğ“Ğ˜Ğ• Ğ¢ĞĞ‘Ğ›Ğ˜Ğ¦Ğ« Ğ ĞĞ¡ĞŸĞ Ğ•Ğ”Ğ•Ğ›Ğ˜Ğ¢Ğ¬

ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ²ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ´ĞµĞ¿Ğ°Ñ€Ñ‚Ğ°Ğ¼ĞµĞ½Ñ‚Ñ‹

=Ğ•Ğ¡Ğ›Ğ˜(ĞŸĞĞ˜Ğ¡Ğš("."; A8)>0; A8; "")

import pandas as pd
import re

data = pd.read_excel("dan2.xlsx",sheet_name = "Ğ›Ğ¸ÑÑ‚1",names=["DepartmentId","Name","ParentId","Rank"])

def find_parent(department_name,data):
    parent_prefix = str(department_name).split('.')[0]
    for index,row in data.iterrows():
        if str(row["Name"]).startswith(parent_prefix) and str(row["Name"]) != str(department_name):
            return row["DepartmentId"]
    return None

def clean_department(department_name):
    return re.sub(r'[0-9.]','',department_name).strip()

def get_rank(department_name):
    return str(department_name).count('.')

data["DepartmentName"] = data["Name"].apply(clean_department)
data["DepartmentParentId"] = data["Name"].apply(lambda x:find_parent(x,data))
data["DepartmentRank"] = data["Name"].apply(get_rank)

data = data.drop(columns=["Name","Rank","ParentId"])

data.to_excel("deps.xlsx",index=None)



-- Ğ’ÑÑ‚Ğ°Ğ²ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ positions Ñ Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒÑÑ‰Ğ¸Ñ… Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹
INSERT IGNORE INTO positions (Title)
SELECT DISTINCT Position FROM employees_data;

-- Ğ’ÑÑ‚Ğ°Ğ²ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ employees
INSERT INTO employees (FullName, DepartmentId, PositionId)
SELECT 
    Name, 
    (SELECT DepartmentId FROM departments WHERE Name = Department LIMIT 1),
    (SELECT PositionId FROM positions WHERE Title = Position LIMIT 1)
FROM employees_data;

-- Ğ’ÑÑ‚Ğ°Ğ²ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ employeepersonalinfo
INSERT INTO employees_personal_info (BirthDate, EmployeeId)
SELECT 
    STR_TO_DATE(BirthDate, '%Y-%m-%d') AS BirthDate,
    employees.EmployeeId
FROM employees_data
JOIN employees ON employees.FullName = employees_data.Name;

-- Ğ’ÑÑ‚Ğ°Ğ²ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ employeecontacts
INSERT INTO employees_contacts (MobilePhone,WorkPhone, Email, OfficeNumber, EmployeeId)
SELECT 
    Phone, 
    Phone,
    Email, 
    Cabinet,
    employees.EmployeeId
FROM employees_data
JOIN employees  ON employees.FullName = employees_data.Name;

ĞĞŸĞ˜Ğ¨Ğ•Ğ§ĞšĞ
database.py
from sqlalchemy import create_engine
from sqlalchemy.orm import declarative_base,sessionmaker

DATABASE_URL = "mysql+pymysql://moodleuser:moodleuserpsw@localhost/wsr"
engine = create_engine(DATABASE_URL)

SessionLocal = sessionmaker(bind=engine)
Base = declarative_base()

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()


from sqlalchemy.ext.automap import automap_base
from database import engine

Base = automap_base()
Base.prepare(engine,reflect=True)

Department = Base.classes.departments



ĞĞŸĞ˜:

from fastapi import FastAPI,HTTPException,Header,Depends

import datetime

import jwt

from pydantic import BaseModel

  

SECRET_KEY ="secret"

users={"admin":"password"}

  
  

app = FastAPI()

  

documents = [

{"id": 1,"title": "Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚1","date_created": "2024-05-01 14:44:44","date_updated": "2024-05-01 14:44:44","category": "Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ","has_comments": "true"},

{"id": 2,"title": "Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚2","date_created": "2024-05-01 14:44:44","date_updated": "2024-05-01 14:44:44","category": "Ğ¤ÑĞ½Ñ‚ÑĞ·Ğ¸","has_comments": "false"}

]

  
  

comments = [

Â  Â  {"id": 1, "document_id": 1, "text": "Hello world", "date_created": "2024-05-01 14:44:44", "date_updated": "2024-05-01 14:44:44", "author": {"name": "ĞŸĞµÑ‚Ñ€Ğ¾Ğ² ĞŸĞµÑ‚Ñ€", "position": "ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€"}},

Â  Â  {"id": 2, "document_id": 1, "text": "Another comment", "date_created": "2024-05-02 09:00:00", "date_updated": "2024-05-02 09:00:00", "author": {"name": "Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ²Ğ° Ğ˜Ñ€Ğ¸Ğ½Ğ°", "position": "ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€"}}

]

  

def create_token(username:str):

Â  Â  payload={

Â  Â  Â  Â  "sub":username,

Â  Â  Â  Â  "exp":datetime.datetime.now()+datetime.timedelta(hours=1)

Â  Â  }

Â  Â  return jwt.encode(payload,SECRET_KEY,algorithm="HS256")

  
  

@app.post("/api/v1/SignIn")

def login(data:dict):

Â  Â  username = data.get("username")

Â  Â  password = data.get("password")

  

Â  Â  if users.get(username)!=password:

Â  Â  Â  Â  raise HTTPException(status_code=403,detail="ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ")

  

Â  Â  token = create_token(username)

Â  Â  return {"access_token":token}

  
  

def verify_token(authorization:str=Header(None)):

Â  Â  print(authorization)

Â  Â  if not authorization:

Â  Â  Â  Â  raise HTTPException(status_code=403,detail="Ğ¢Ğ¾ĞºĞµĞ½ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ĞµĞ½")

Â  Â  try:

Â  Â  Â  Â  token = authorization.split(" ")[1]

Â  Â  Â  Â  payload = jwt.decode(token,SECRET_KEY,algorithms=["HS256"])

Â  Â  Â  Â  return payload["sub"]

Â  Â  except jwt.ExpiredSignatureError:

Â  Â  Â  Â  raise HTTPException(status_code=403,detail="Ğ˜ÑÑ‚Ñ‘Ğº")

Â  Â  except jwt.InvalidTokenError:

Â  Â  Â  Â  raise HTTPException(status_code=403,detail="ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ‚Ğ¾ĞºĞµĞ½")

  

@app.get('/api/v1/Documents')

def read_root(user:str=Depends(verify_token)):

Â  Â  return documents

  
  

@app.get("/api/v1/Document/{document_id}/Comments")

def get_comments(document_id: int, user:str = Depends(verify_token)):

Â  Â  # Ğ˜Ñ‰ĞµĞ¼ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ Ğ¿Ğ¾ document_id

Â  Â  doc_comments = [comment for comment in comments if comment["document_id"] == document_id]

Â  Â  if not doc_comments:

Â  Â  Â  Â  raise HTTPException(status_code=404, detail="ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹")

Â  Â  return doc_comments

  

class CommentCreate(BaseModel):

Â  Â  text: str

Â  Â  author_name: str

Â  Â  author_position: str

  

# ğŸ“Œ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ Ğº Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñƒ

@app.post("/api/v1/Document/{document_id}/Comment")

def add_comment(document_id: int, comment: CommentCreate):

Â  Â  # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ»Ğ¸ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚

Â  Â  document = next((doc for doc in documents if doc["id"] == document_id), None)

Â  Â  if not document:

Â  Â  Â  Â  raise HTTPException(status_code=404, detail="Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½")

  

Â  Â  # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ°

Â  Â  new_author = {"name": comment.author_name, "position": comment.author_position}

  

Â  Â  # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹

Â  Â  new_comment = {

Â  Â  Â  Â  "id": len(comments) + 1,

Â  Â  Â  Â  "document_id": document_id,

Â  Â  Â  Â  "text": comment.text,

Â  Â  Â  Â  "date_created": datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S"),

Â  Â  Â  Â  "date_updated": datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S"),

Â  Â  Â  Â  "author": new_author

Â  Â  }

  

Â  Â  comments.append(new_comment)

Â  Â  return new_comment
